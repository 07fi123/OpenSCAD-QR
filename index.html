<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>QR Code Generator</title>
    <meta charset="utf-8" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.3.1/qrcode.min.js" integrity="sha256-i/Kr7ZdNPsKHLorW3YFlxrMIAhy+WHmRQazizcqUiCg=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        function UpdateQrCode() {
            var data = document.getElementById("url").value;

            // Create QR Code
            var qr = qrcode(0, "L");
            qr.addData(data);
            qr.make();

            // Show preview
            document.getElementById("qr").innerHTML = qr.createImgTag(10, 0);

            // Add OpenSCAD code prologue
            var module_count = qr.getModuleCount()
            code = "// QR code data for \"" + data + "\" (" + module_count + " x " + module_count +")\r\n";
            code += "// Generated by Altair's OpenSCAD QR Code Generator\r\n";
            code += "// https://github.com/ridercz/OpenSCAD-QR\r\n";

            // Add QR code data
            for(var r = 0; r < module_count; r++){
                if(r == 0) {
                    code += "qr_data = [[";
                } else {
                    code += "           ["
                }
                for(var c = 0; c < module_count; c++){
                    var pixelValue = qr.isDark(r, c);
                    code += pixelValue ? "1" : "0";
                    if (c < module_count - 1) code += ","
                }
                if(r < module_count - 1) {
                    code += "],\r\n";
                } else {
                    code += "]];\r\n\r\n";
                }
            }

            // Add OpenSCAD code epilogue
            code += "// Render QR code with default settings (module 1x1x1)\r\n";
            code += "qr_render(qr_data);\r\n";
            code += "\r\n";
            code += "// QR code rendering method\r\n";
            code += "module qr_render(data, module_size = 1, height = 1) {\r\n";
            code += "    maxmod = len(data) - 1;\r\n";
            code += "    union() {\r\n";
            code += "        for(r = [0 : maxmod]) {\r\n";
            code += "            for(c = [0 : maxmod]) {\r\n";
            code += "                if(data[r][c] == 1){\r\n";
            code += "                    xo = c * module_size;\r\n";
            code += "                    yo = (maxmod - r) * module_size;\r\n";
            code += "                    translate([xo, yo, 0]) cube([module_size, module_size, height]);\r\n";
            code += "                }\r\n";
            code += "            }\r\n";
            code += "        }\r\n";
            code += "    }\r\n";
            code += "}\r\n";
            document.getElementById("code").innerText = code;

            // Prevent form submission
            return false;
        }
    </script>
    <style type="text/css">
        html { 
            background-color: #ffc; 
            color: 000; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; padding:0;
        }
        body {
            max-width: 1100px;
            margin: 3em auto;
        }
        h1 {
            font-weight: 100; text-align: center;
        }
        .module {
            border: 2px solid #000;
            background-color: #fff;
            border-radius: 1em;
            padding: 2em;
            margin-bottom: 1em;
        }
        #input, #qr {
            text-align: center;
        }
        #url {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 1.2em;
            padding: .5em;
            border: 1px solid #ccc;
            border-radius: .5em;
            box-sizing: border-box;
            color: #000; background-color: #fff;
            width: 75%;
        }
        #submit {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 1.2em;
            padding: .5em;
            border: 1px solid #000;
            border-radius: .5em;
            box-sizing: border-box;
            color: #fff; 
            background-color: #666;
            width: 20%;
        }
        #code {
            font-family: Consolas, 'Lucida Console', 'Courier New', Courier, monospace;
            white-space: pre;
        }
        footer {
            font-size: 80%; 
            text-align: center;
        }
        a:link, a:visited {
            color:#000;
        }
        a:hover {
            color:#c00;
        }
    </style>
</head>
<body onload="UpdateQrCode()">
    <h1>OpenSCAD QR Code Generator</h1>
    <form onsubmit="return UpdateQrCode()">
        <div id="input" class="module">
            <p><label for="url">Enter URL or other value to encode:</label></p>
            <input type="text" name="url" id="url" value="https://www.rider.cz/" />
            <input type="submit" name="submit" id="submit" value="Generate" />
        </div>
    </form>
    <div id="qr" class="module"></div>
    <div id="code" class="module"></div>
    <footer>
        Version 1.0 | Using <a href="https://github.com/kazuhikoarase/qrcode-generator">qrcode-generator</a> by Kazuhiko Arase | Copyright &copy; <a href="https://www.rider.cz/">Michal A. Valášek</a>, <a href="https://www.altairis.cz">Altairis</a>, 2017 
    </footer>
</body>
</html>